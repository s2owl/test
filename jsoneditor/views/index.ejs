<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network API Management</title>
    <link rel="stylesheet" href="/<%= appName %>/style.css">
</head>
<body>
    <div class="container">
        <h1>Network API Management</h1>

        <% if (message) { %>
            <div class="message <%= message.includes('Error') || message.includes('No file') || message.includes('Invalid') ? 'error' : '' %>">
                <%= message %>
            </div>
        <% } %>

        <h2>Add New Parent API</h2>
        <form action="/<%= appName %>/add-parent" method="POST">
            <label for="parent_name">Parent Name:</label>
            <input type="text" id="parent_name" name="parent_name" required>

            <label for="parent_description">Description:</label>
            <textarea id="parent_description" name="parent_description"></textarea>

            <label for="parent_version">Version:</label>
            <input type="text" id="parent_version" name="parent_version" value="1.0.0">

            <label for="parent_label">Label (e.g., strategic, niche, contain):</label>
            <input type="text" id="parent_label" name="parent_label" value="strategic">

            <button type="submit">Add Parent API</button>
        </form>

        <h2>Existing Parent APIs</h2>
        <% if (parents.length === 0) { %>
            <p>No Parent APIs found. Add your first one above!</p>
        <% } else { %>
            <% parents.forEach(parent => { %>
                <div class="item">
                    <div class="details">
                        <h3><%= parent.name %> (v<%= parent.parent_version %>) <small>(ID: <%= parent.id %>)</small></h3>
                        <p><%= parent.description %></p>
                        <p><strong>Label:</strong> <%= parent.label %></p>
                        <p><strong>Components:</strong> <%= parent.components ? parent.components.length : 0 %></p>
                    </div>
                    <div class="actions">
                        <a href="/<%= appName %>/parent/<%= parent.id %>" class="button">View/Edit Components</a>

                        <form action="/<%= appName %>/update-parent" method="POST" style="display: none;" class="edit-parent-form">
                            <input type="hidden" name="id" value="<%= parent.id %>">
                            <label for="edit_parent_name_<%= parent.id %>">Name:</label>
                            <input type="text" id="edit_parent_name_<%= parent.id %>" name="parent_name" value="<%= parent.name %>" required>
                            <label for="edit_parent_description_<%= parent.id %>">Description:</label>
                            <textarea id="edit_parent_description_<%= parent.id %>" name="parent_description"><%= parent.description %></textarea>
                            <label for="edit_parent_version_<%= parent.id %>">Version:</label>
                            <input type="text" id="edit_parent_version_<%= parent.id %>" name="parent_version" value="<%= parent.parent_version %>">
                            <label for="edit_parent_label_<%= parent.id %>">Label:</label>
                            <input type="text" id="edit_parent_label_<%= parent.id %>" name="parent_label" value="<%= parent.label %>">
                            <button type="submit">Save Parent</button>
                            <button type="button" class="cancel-edit-parent">Cancel</button>
                        </form>
                        <button onclick="toggleEditParentForm(this)">Edit Parent</button>

                        <form action="/<%= appName %>/delete-parent" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this Parent API and all its components?');">
                            <input type="hidden" name="id" value="<%= parent.id %>">
                            <button type="submit" class="delete">Delete Parent</button>
                        </form>
                    </div>
                </div>
            <% }) %>
        <% } %>

        <div class="file-upload-section">
            <h2>Manage All Data File</h2>
            <form action="/<%= appName %>/upload" method="POST" enctype="multipart/form-data">
                <label for="jsonFile">Upload JSON File:</label>
                <input type="file" id="jsonFile" name="jsonFile" accept=".json" required>
                <button type="submit">Upload & Replace All</button>
                <p><small>This will replace all current data with the contents of your uploaded JSON file.</small></p>
            </form>

            <form action="/<%= appName %>/download" method="GET">
                <button type="submit">Download All Current JSON</button>
                <p><small>Downloads a copy of all your current data as 'mydata.json'.</small></p>
            </form>
        </div>
    </div>

    <script>
        function toggleEditParentForm(button) {
            const itemDiv = button.closest('.item');
            const editForm = itemDiv.querySelector('.edit-parent-form');
            const otherElementsToHide = itemDiv.querySelectorAll('.actions > a.button, .actions > button:not(.cancel-edit-parent), .actions > form:not(.edit-parent-form)');

            if (editForm.style.display === 'none' || editForm.style.display === '') {
                editForm.style.display = 'block';
                otherElementsToHide.forEach(el => el.style.display = 'none');
            } else {
                editForm.style.display = 'none';
                otherElementsToHide.forEach(el => {
                    if (el.tagName === 'FORM') { el.style.display = 'inline'; }
                    else if (el.tagName === 'A') { el.style.display = 'inline-block'; }
                    else { el.style.display = 'inline-block'; }
                });
            }
        }

        document.querySelectorAll('.cancel-edit-parent').forEach(button => {
            button.addEventListener('click', function() {
                const itemDiv = this.closest('.item');
                const editForm = itemDiv.querySelector('.edit-parent-form');
                const otherElementsToShow = itemDiv.querySelectorAll('.actions > a.button, .actions > button:not(.cancel-edit-parent), .actions > form:not(.edit-parent-form)');

                editForm.style.display = 'none';
                otherElementsToShow.forEach(el => {
                    if (el.tagName === 'FORM') { el.style.display = 'inline'; }
                    else if (el.tagName === 'A') { el.style.display = 'inline-block'; }
                    else { el.style.display = 'inline-block'; }
                });
            });
        });
    </script>
</body>
</html>
